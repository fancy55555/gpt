(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=e(t);fetch(t.href,i)}})();class l{constructor(r,e,s){this.id=r,this.name=e,this.messages=s}}class d{constructor(){this.dialogs=JSON.parse(localStorage.getItem("dialogs"))||[{id:0,name:"Dialog",messages:[]}],this.current=null}create(r,e,s){this.dialogs=this.dialogs.filter(i=>i.messages.length>0);const t=new l(r,e,s);return this.dialogs.push(t),this.current=t,t}remove(r){this.dialogs=this.dialogs.filter(e=>e.id!==r)}clear(){this.dialogs=[],this.current=null}save(){localStorage.setItem("dialogs",JSON.stringify(this.dialogs))}}class h{constructor(r){this.model=r,this.allowed=!0,this.dialogs={container:document.querySelector("#dialogs_container"),create:document.querySelector("#dialogs_create"),clear:document.querySelector("#dialogs_clear")},this.chat={container:document.querySelector("#chat_container"),send:document.querySelector("#chat_send"),textarea:document.querySelector("#chat_textarea"),loading:document.querySelector("#chat_loading")},this.render={dialogs:()=>{const e=this.model.current;this.dialogs.container.innerHTML="",this.model.dialogs.length>0&&this.model.dialogs.forEach(s=>{const t=document.createElement("li"),i=["text-white","transition","ease-in-out","delay-50","rounded-full","px-3.5","py-1.5","cursor-pointer"],a=["bg-indigo-400/75","text-black/90"];t.classList.add(...i),e&&s.id===e.id&&t.classList.add(...a),t.textContent=s.name,t.addEventListener("click",()=>{this.model.current=s,document.querySelectorAll(`${this.dialogs.container.tagName} li`).forEach(o=>{a.forEach(n=>o.classList.remove(n))}),t.classList.add(...a),this.render.chat()}),this.dialogs.container.append(t)})},chat:()=>{const e=this.model.current;this.chat.container.innerHTML="",e&&e.messages.forEach(s=>{const t=`
                            <div class="flex gap-7 items-start">
                              <img class="invert w-7 square" src="/${s.role==="system"?"openai-logomark":"user"}.svg" alt="">
                              <div class="flex flex-col gap-5 ${s.role==="system"?"text-indigo-300":"text-white"}">${s.content.replace(/\n/g,"<br>")}</div>
                            </div>
                        `;this.chat.container.innerHTML+=t})},all:()=>{this.render.dialogs(),this.render.chat()}},this.chat.container.addEventListener("click",e=>{const s=e.target.closest("button[data-code]");s&&this.copyCode(s)}),this.dialogs.create.addEventListener("click",()=>{const e=Math.round(Math.random()*55555),s=`Dialog | ${e}`,t=[];this.model.create(e,s,t),this.model.save(),this.render.dialogs(),this.render.chat(),this.chat.textarea.focus()}),this.dialogs.clear.addEventListener("click",()=>{this.model.clear(),this.model.save(),this.render.dialogs(),this.render.chat()}),this.chat.send.addEventListener("click",()=>{this.send()}),this.chat.textarea.addEventListener("keydown",e=>{e.code==="Enter"&&(e.preventDefault(),this.send())}),this.chat.textarea.addEventListener("input",e=>{e.target.scrollHeight>200?(e.target.style.overflow="auto",e.target.style.height="200px",e.target.classList.add("scrollable")):(e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px",e.target.style.overflow="hidden")}),this.chat.textarea.addEventListener("blur",e=>{e.target.style.height="auto"})}async send(){if(this.allowed){this.allowed=!1,this.chat.loading.classList.add("opacity-50");const r=this.chat.textarea,e=r.value.trim();if(r.value="",e){let s;if(this.model.current)s=this.model.dialogs.find(a=>a.id===this.model.current.id);else{const a=Math.round(Math.random()*55555),o=`from chat | ${a}`,n=[];s=this.model.create(a,o,n)}s.messages.push({role:"user",content:e});const i=await(await this.interact(this.model.current.messages)).json();s.messages.push({role:"system",content:this.handle(i.choices[0].message.content)}),this.model.save(),this.render.chat(),this.render.dialogs()}this.chat.loading.classList.remove("opacity-50"),this.allowed=!0}}async interact(r){return await fetch("https://api.openai.com/v1/chat/completions",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer 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"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:r})})}handle(r){const e=/```(\w+)([\s\S]+?)```/g,s=[...r.matchAll(e)];return s.length&&s.forEach(t=>{const i=t[1],a=t[2].trim(),o=`<div class="rounded-md overflow-auto"><div class="flex justify-between items-center bg-white/10 px-5 py-2.5"><span class="text-white text-xs">${i}</span><button class="text-white text-xs" data-code="${this.escapeHtml(a)}">Copy code</button></div><pre class="p-5 text-white bg-black/80"><code>${a}</code></pre></div>`;r=r.replace(t[0],o)}),r}async copyCode(r){const e=r.getAttribute("data-code");try{await navigator.clipboard.writeText(e),r.innerText="Copied",setTimeout(()=>{r.innerText="Copy code"},2e3)}catch(s){console.error("Error",s)}}escapeHtml(r){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return r.replace(/[&<>"']/g,function(s){return e[s]})}}const u=new d,g=new h(u);g.render.all();
